<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3SF-mini Consensus — ethlambda</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

  :root {
    --bg: #0F172A;
    --bg-card: #1E293B;
    --bg-elevated: #334155;
    --text: #F8FAFC;
    --text-dim: #94A3B8;
    --text-muted: #64748B;
    --indigo: #6366F1;
    --indigo-light: #818CF8;
    --emerald: #10B981;
    --emerald-dim: #065F46;
    --amber: #F59E0B;
    --amber-dim: #78350F;
    --cyan: #06B6D4;
    --red: #EF4444;
    --purple: #A855F7;
    --border: #334155;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    overflow-x: hidden;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }

  /* ─── HERO ───────────────────────────────── */
  .hero {
    text-align: center;
    padding: 3rem 0 2rem;
    border-bottom: 1px solid var(--border);
    margin-bottom: 3rem;
  }
  .hero-badge {
    display: inline-block;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: var(--indigo-light);
    background: rgba(99, 102, 241, 0.15);
    border: 1px solid rgba(99, 102, 241, 0.3);
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    margin-bottom: 1rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }
  .hero h1 {
    font-size: 2.75rem;
    font-weight: 800;
    letter-spacing: -0.02em;
    margin-bottom: 0.75rem;
    background: linear-gradient(135deg, var(--text), var(--indigo-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .hero p {
    font-size: 1.15rem;
    color: var(--text-dim);
    max-width: 700px;
    margin: 0 auto;
  }

  /* ─── SECTIONS ───────────────────────────── */
  .section {
    margin-bottom: 3.5rem;
  }
  .section-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }
  .section-number {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--indigo-light);
    background: rgba(99, 102, 241, 0.15);
    width: 28px; height: 28px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 6px;
    flex-shrink: 0;
  }
  .section h2 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.01em;
  }
  .section-desc {
    color: var(--text-dim);
    font-size: 0.95rem;
    margin-bottom: 1.5rem;
    max-width: 700px;
  }

  /* ─── CARDS ──────────────────────────────── */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
  }

  /* ─── 1. SLOT TIMELINE ──────────────────── */
  .slot-timeline {
    display: grid;
    grid-template-columns: 80px 1fr;
    gap: 0;
    position: relative;
  }
  .slot-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-muted);
    padding: 1rem 0.75rem;
    text-align: right;
    border-right: 2px solid var(--border);
  }
  .slot-content {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid rgba(51, 65, 85, 0.5);
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  .slot-content:last-child { border-bottom: none; }
  .interval-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .interval-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    padding: 0.15rem 0.5rem;
    border-radius: 4px;
    flex-shrink: 0;
    font-weight: 500;
  }
  .interval-desc {
    font-size: 0.85rem;
    color: var(--text-dim);
  }
  .interval-desc strong { color: var(--text); font-weight: 600; }

  .i0 .interval-dot { background: var(--amber); }
  .i0 .interval-tag { background: rgba(245, 158, 11, 0.15); color: var(--amber); }
  .i1 .interval-dot { background: var(--indigo-light); }
  .i1 .interval-tag { background: rgba(99, 102, 241, 0.15); color: var(--indigo-light); }
  .i2 .interval-dot { background: var(--purple); }
  .i2 .interval-tag { background: rgba(168, 85, 247, 0.15); color: var(--purple); }
  .i3 .interval-dot { background: var(--emerald); }
  .i3 .interval-tag { background: rgba(16, 185, 129, 0.15); color: var(--emerald); }

  /* ─── 2. JUSTIFIABILITY GRID ─────────────── */
  .justifiability-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-bottom: 1.25rem;
  }
  .slot-cell {
    width: 38px; height: 38px;
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    font-weight: 500;
    transition: transform 0.15s;
    position: relative;
  }
  .slot-cell:hover { transform: scale(1.15); z-index: 1; }
  .slot-cell.justifiable {
    background: rgba(16, 185, 129, 0.2);
    border: 1px solid rgba(16, 185, 129, 0.4);
    color: var(--emerald);
  }
  .slot-cell.unjustifiable {
    background: rgba(100, 116, 139, 0.1);
    border: 1px solid rgba(100, 116, 139, 0.2);
    color: var(--text-muted);
  }
  .slot-cell.finalized {
    background: rgba(245, 158, 11, 0.25);
    border: 1px solid rgba(245, 158, 11, 0.5);
    color: var(--amber);
  }

  .legend {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    margin-bottom: 1rem;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    color: var(--text-dim);
  }
  .legend-swatch {
    width: 14px; height: 14px;
    border-radius: 4px;
    flex-shrink: 0;
  }

  .rules-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.75rem;
    margin-top: 1rem;
  }
  .rule-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
  }
  .rule-card h4 {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--indigo-light);
    margin-bottom: 0.35rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .rule-formula {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.95rem;
    color: var(--text);
    margin-bottom: 0.35rem;
    font-weight: 500;
  }
  .rule-examples {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--text-muted);
  }

  /* ─── 3. ATTESTATION PIPELINE ────────────── */
  .pipeline {
    display: flex;
    align-items: stretch;
    gap: 0;
    overflow-x: auto;
    padding-bottom: 0.5rem;
  }
  .pipeline-stage {
    flex: 1;
    min-width: 140px;
    text-align: center;
    position: relative;
  }
  .pipeline-icon {
    width: 56px; height: 56px;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 0.75rem;
    font-size: 1.5rem;
  }
  .pipeline-stage h4 {
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }
  .pipeline-stage p {
    font-size: 0.75rem;
    color: var(--text-muted);
    padding: 0 0.25rem;
  }
  .pipeline-arrow {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    flex-shrink: 0;
    color: var(--text-muted);
    font-size: 1.25rem;
  }
  .pipeline-arrow .trigger {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: var(--amber);
    position: absolute;
    top: -18px;
    white-space: nowrap;
  }

  .p-gossip .pipeline-icon { background: rgba(6, 182, 212, 0.15); border: 1px solid rgba(6, 182, 212, 0.3); color: var(--cyan); }
  .p-pending .pipeline-icon { background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.3); color: var(--amber); }
  .p-known .pipeline-icon { background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); color: var(--emerald); }
  .p-fork .pipeline-icon { background: rgba(99, 102, 241, 0.15); border: 1px solid rgba(99, 102, 241, 0.3); color: var(--indigo-light); }
  .p-block .pipeline-icon { background: rgba(168, 85, 247, 0.15); border: 1px solid rgba(168, 85, 247, 0.3); color: var(--purple); }

  /* ─── 4. FINALIZATION CHAIN ──────────────── */
  .finalization-chain {
    position: relative;
    padding: 1rem 0;
  }
  .chain-row {
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
    gap: 6px;
    flex-wrap: wrap;
  }
  .chain-slot {
    width: 40px; height: 40px;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    font-weight: 600;
    flex-shrink: 0;
    position: relative;
  }
  .chain-slot.s-finalized {
    background: rgba(245, 158, 11, 0.25);
    border: 2px solid var(--amber);
    color: var(--amber);
  }
  .chain-slot.s-justified {
    background: rgba(16, 185, 129, 0.2);
    border: 2px solid var(--emerald);
    color: var(--emerald);
  }
  .chain-slot.s-unjustified {
    background: rgba(100, 116, 139, 0.1);
    border: 1px solid rgba(100, 116, 139, 0.25);
    color: var(--text-muted);
  }
  .chain-slot.s-empty {
    background: transparent;
    border: 1px dashed rgba(100, 116, 139, 0.2);
    color: var(--text-muted);
    opacity: 0.5;
  }

  .chain-annotation {
    font-size: 0.75rem;
    color: var(--text-dim);
    margin-left: 0.75rem;
    font-style: italic;
  }
  .chain-annotation .highlight {
    font-style: normal;
    font-weight: 600;
  }
  .chain-annotation .highlight.green { color: var(--emerald); }
  .chain-annotation .highlight.gold { color: var(--amber); }
  .chain-annotation .highlight.red { color: var(--red); }

  .chain-arrow {
    color: var(--text-muted);
    font-size: 0.8rem;
    flex-shrink: 0;
  }

  .chain-epoch-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--text-muted);
    width: 100%;
    margin-bottom: 0.25rem;
    padding-left: 0.25rem;
  }

  /* ─── 5. LMD-GHOST (SVG) ─────────────────── */
  .ghost-svg-wrap {
    display: flex;
    justify-content: center;
    padding: 0.5rem 0;
  }
  .ghost-svg-wrap svg { overflow: visible; }

  /* ─── FOOTER ─────────────────────────────── */
  .footer {
    text-align: center;
    padding: 2rem 0;
    border-top: 1px solid var(--border);
    margin-top: 2rem;
  }
  .footer p {
    font-size: 0.8rem;
    color: var(--text-muted);
  }
  .footer a {
    color: var(--indigo-light);
    text-decoration: none;
  }

  /* ─── TOOLTIPS ───────────────────────────── */
  .tooltip {
    position: relative;
    cursor: help;
  }
  .tooltip::after {
    content: attr(data-tip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    color: var(--text);
    font-size: 0.7rem;
    font-family: 'JetBrains Mono', monospace;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.15s;
    z-index: 10;
  }
  .tooltip:hover::after { opacity: 1; }

  /* ─── RESPONSIVE ─────────────────────────── */
  @media (max-width: 700px) {
    .hero h1 { font-size: 1.75rem; }
    .rules-grid { grid-template-columns: 1fr; }
    .pipeline { flex-direction: column; align-items: center; }
    .pipeline-arrow { transform: rotate(90deg); width: auto; height: 30px; }
  }
</style>
</head>
<body>

<div class="container">

  <!-- ═══════ HERO ═══════ -->
  <div class="hero">
    <div class="hero-badge">ethlambda consensus</div>
    <h1>3SF-mini</h1>
    <p>A slot-level finality protocol that concentrates validator votes through justifiability backoff, enabling fast finalization under good conditions and graceful degradation under adversity.</p>
  </div>

  <!-- ═══════ 1. SLOT TIMELINE ═══════ -->
  <div class="section">
    <div class="section-header">
      <div class="section-number">1</div>
      <h2>Slot Structure: 4 Seconds, 4 Intervals</h2>
    </div>
    <p class="section-desc">Each slot is divided into four 1-second intervals. Validators perform specific duties at each interval, orchestrating block production, attestation, and fork choice updates.</p>

    <div class="card">
      <div class="slot-timeline">
        <div class="slot-label">0s</div>
        <div class="slot-content i0">
          <div class="interval-dot"></div>
          <span class="interval-tag">INT 0</span>
          <span class="interval-desc"><strong>Proposer:</strong> accept pending attestations &rarr; run fork choice &rarr; build &amp; publish block</span>
        </div>

        <div class="slot-label">1s</div>
        <div class="slot-content i1">
          <div class="interval-dot"></div>
          <span class="interval-tag">INT 1</span>
          <span class="interval-desc"><strong>All validators:</strong> produce attestations (head, target, source) &rarr; gossip to network</span>
        </div>

        <div class="slot-label">2s</div>
        <div class="slot-content i2">
          <div class="interval-dot"></div>
          <span class="interval-tag">INT 2</span>
          <span class="interval-desc"><strong>Safe target:</strong> run fork choice with 2/3 threshold &rarr; update target for next attestations</span>
        </div>

        <div class="slot-label">3s</div>
        <div class="slot-content i3">
          <div class="interval-dot"></div>
          <span class="interval-tag">INT 3</span>
          <span class="interval-desc"><strong>Accept:</strong> promote accumulated attestations &rarr; update fork choice head</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════ 2. JUSTIFIABILITY RULES ═══════ -->
  <div class="section">
    <div class="section-header">
      <div class="section-number">2</div>
      <h2>Justifiability: Which Slots Can Be Justified?</h2>
    </div>
    <p class="section-desc">Not every slot is eligible for justification. The distance (delta) from the last finalized slot determines eligibility through three rules. This backoff creates fewer targets over time, concentrating votes to reach the 2/3 supermajority threshold.</p>

    <div class="card">
      <div class="rules-grid">
        <div class="rule-card">
          <h4>Rule 1: Proximity</h4>
          <div class="rule-formula">&delta; &le; 5</div>
          <div class="rule-examples">0, 1, 2, 3, 4, 5</div>
        </div>
        <div class="rule-card">
          <h4>Rule 2: Perfect Square</h4>
          <div class="rule-formula">&delta; = n&sup2;</div>
          <div class="rule-examples">1, 4, 9, 16, 25, 36, 49 &hellip;</div>
        </div>
        <div class="rule-card">
          <h4>Rule 3: Pronic Number</h4>
          <div class="rule-formula">&delta; = n(n+1)</div>
          <div class="rule-examples">2, 6, 12, 20, 30, 42, 56 &hellip;</div>
        </div>
      </div>

      <div style="margin-top:1.25rem">
        <div class="legend">
          <div class="legend-item"><div class="legend-swatch" style="background:rgba(245,158,11,0.35);border:1px solid var(--amber)"></div> Finalized (slot 0)</div>
          <div class="legend-item"><div class="legend-swatch" style="background:rgba(16,185,129,0.25);border:1px solid rgba(16,185,129,0.5)"></div> Justifiable</div>
          <div class="legend-item"><div class="legend-swatch" style="background:rgba(100,116,139,0.15);border:1px solid rgba(100,116,139,0.25)"></div> Unjustifiable</div>
        </div>
        <div class="justifiability-grid" id="justGrid"></div>
        <p style="font-size:0.75rem;color:var(--text-muted);margin-top:0.5rem">Delta from finalized slot 0. Hover for rule. Note how gaps widen — forcing vote concentration.</p>
      </div>
    </div>
  </div>

  <!-- ═══════ 3. ATTESTATION PIPELINE ═══════ -->
  <div class="section">
    <div class="section-header">
      <div class="section-number">3</div>
      <h2>Attestation Pipeline</h2>
    </div>
    <p class="section-desc">Attestations flow through a two-stage pool before affecting fork choice. This batching prevents attestation-by-attestation recomputation of the head.</p>

    <div class="card">
      <div class="pipeline">
        <div class="pipeline-stage p-gossip">
          <div class="pipeline-icon">&#x1F4E1;</div>
          <h4>Gossip</h4>
          <p>Validator signs &amp; broadcasts attestation via P2P</p>
        </div>
        <div class="pipeline-arrow">&rarr;</div>
        <div class="pipeline-stage p-pending">
          <div class="pipeline-icon">&#x23F3;</div>
          <h4>Pending Pool</h4>
          <p><code style="font-size:0.7rem;color:var(--amber)">new_attestations</code><br>Awaiting promotion</p>
        </div>
        <div class="pipeline-arrow" style="position:relative">
          &rarr;
          <span style="position:absolute;top:-16px;font-family:'JetBrains Mono',monospace;font-size:0.6rem;color:var(--amber);white-space:nowrap">int 0 / int 3</span>
        </div>
        <div class="pipeline-stage p-known">
          <div class="pipeline-icon">&#x2705;</div>
          <h4>Active Pool</h4>
          <p><code style="font-size:0.7rem;color:var(--emerald)">known_attestations</code><br>Fork choice active</p>
        </div>
        <div class="pipeline-arrow">&rarr;</div>
        <div class="pipeline-stage p-fork">
          <div class="pipeline-icon">&#x1F333;</div>
          <h4>LMD-GHOST</h4>
          <p>Greedy heaviest subtree &rarr; head selection</p>
        </div>
        <div class="pipeline-arrow">&rarr;</div>
        <div class="pipeline-stage p-block">
          <div class="pipeline-icon">&#x1F4E6;</div>
          <h4>In Block</h4>
          <p>Proposer includes aggregated attestations</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════ 4. FORK CHOICE (LMD-GHOST) ═══════ -->
  <div class="section">
    <div class="section-header">
      <div class="section-number">4</div>
      <h2>Fork Choice: LMD-GHOST</h2>
    </div>
    <p class="section-desc">Starting from the justified root, greedily descend the block tree always choosing the child with the highest attestation weight. Ties are broken by block hash.</p>

    <div class="card">
      <div class="ghost-svg-wrap">
        <svg width="520" height="310" viewBox="0 0 520 310" xmlns="http://www.w3.org/2000/svg" font-family="'JetBrains Mono','Inter',monospace">
          <defs>
            <marker id="arrow-g" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
              <path d="M0,0 L6,3 L0,6" fill="none" stroke="#10B981" stroke-width="1.2"/>
            </marker>
            <marker id="arrow-m" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
              <path d="M0,0 L6,3 L0,6" fill="none" stroke="#64748B" stroke-width="1.2"/>
            </marker>
          </defs>

          <!-- ── Edges (drawn first, behind nodes) ── -->
          <!-- Root → A (chosen path) -->
          <line x1="210" y1="52" x2="140" y2="108" stroke="#10B981" stroke-width="2.5" marker-end="url(#arrow-g)"/>
          <!-- Root → B (unchosen) -->
          <line x1="310" y1="52" x2="390" y2="108" stroke="#64748B" stroke-width="1.5" stroke-dasharray="5,4" marker-end="url(#arrow-m)" opacity="0.5"/>
          <!-- A → C (unchosen) -->
          <line x1="105" y1="162" x2="70" y2="218" stroke="#64748B" stroke-width="1.5" stroke-dasharray="5,4" marker-end="url(#arrow-m)" opacity="0.5"/>
          <!-- A → D (chosen path) -->
          <line x1="175" y1="162" x2="210" y2="218" stroke="#10B981" stroke-width="2.5" marker-end="url(#arrow-g)"/>
          <!-- B → E (unchosen) -->
          <line x1="390" y1="162" x2="390" y2="218" stroke="#64748B" stroke-width="1.5" stroke-dasharray="5,4" marker-end="url(#arrow-m)" opacity="0.5"/>

          <!-- ── Level 0: Justified Root ── -->
          <rect x="195" y="10" width="130" height="46" rx="8" fill="rgba(16,185,129,0.15)" stroke="#10B981" stroke-width="1.5"/>
          <text x="260" y="30" fill="#10B981" font-size="11" font-weight="600" text-anchor="middle">Justified Root</text>
          <text x="260" y="46" fill="#10B981" font-size="9" text-anchor="middle" opacity="0.7">weight: 10</text>

          <!-- ── Level 1: Block A (chosen) ── -->
          <rect x="75" y="112" width="130" height="46" rx="8" fill="rgba(16,185,129,0.15)" stroke="#10B981" stroke-width="1.5"/>
          <text x="140" y="132" fill="#10B981" font-size="11" font-weight="600" text-anchor="middle">Block A</text>
          <text x="140" y="148" fill="#10B981" font-size="9" text-anchor="middle" opacity="0.7">weight: 7</text>

          <!-- ── Level 1: Block B (unchosen) ── -->
          <rect x="325" y="112" width="130" height="46" rx="8" fill="rgba(100,116,139,0.08)" stroke="#64748B" stroke-width="1" opacity="0.6"/>
          <text x="390" y="132" fill="#94A3B8" font-size="11" font-weight="500" text-anchor="middle">Block B</text>
          <text x="390" y="148" fill="#64748B" font-size="9" text-anchor="middle">weight: 3</text>

          <!-- ── Level 2: Block C (unchosen) ── -->
          <rect x="5" y="222" width="130" height="46" rx="8" fill="rgba(100,116,139,0.08)" stroke="#64748B" stroke-width="1" opacity="0.6"/>
          <text x="70" y="242" fill="#94A3B8" font-size="11" font-weight="500" text-anchor="middle">Block C</text>
          <text x="70" y="258" fill="#64748B" font-size="9" text-anchor="middle">weight: 2</text>

          <!-- ── Level 2: Block D ★ HEAD ── -->
          <rect x="145" y="222" width="130" height="46" rx="8" fill="rgba(99,102,241,0.25)" stroke="#818CF8" stroke-width="2.5"/>
          <text x="210" y="240" fill="#818CF8" font-size="11" font-weight="700" text-anchor="middle">Block D ★</text>
          <text x="210" y="258" fill="#818CF8" font-size="9" text-anchor="middle" opacity="0.8">weight: 5 ← HEAD</text>

          <!-- ── Level 2: Block E (unchosen) ── -->
          <rect x="325" y="222" width="130" height="46" rx="8" fill="rgba(100,116,139,0.08)" stroke="#64748B" stroke-width="1" opacity="0.6"/>
          <text x="390" y="242" fill="#94A3B8" font-size="11" font-weight="500" text-anchor="middle">Block E</text>
          <text x="390" y="258" fill="#64748B" font-size="9" text-anchor="middle">weight: 3</text>

          <!-- ── Path annotation ── -->
          <text x="260" y="298" fill="#94A3B8" font-size="10" text-anchor="middle">Root → A (7 &gt; 3) → D (5 &gt; 2)  ·  Greedy descent selects heaviest leaf</text>
        </svg>
      </div>
    </div>
  </div>

  <!-- ═══════ 5. JUSTIFICATION & FINALIZATION ═══════ -->
  <div class="section">
    <div class="section-header">
      <div class="section-number">5</div>
      <h2>Justification &amp; Finalization</h2>
    </div>
    <p class="section-desc">A slot becomes <strong style="color:var(--emerald)">justified</strong> when &ge;2/3 of validators attest to it. It becomes <strong style="color:var(--amber)">finalized</strong> when two consecutive justifiable slots are both justified with no justifiable gaps between them.</p>

    <div class="card">
      <!-- Step 1 -->
      <div class="chain-epoch-label">Step 1: Genesis</div>
      <div class="chain-row">
        <div class="chain-slot s-finalized tooltip" data-tip="Genesis: finalized + justified">0</div>
        <div class="chain-slot s-empty">1</div>
        <div class="chain-slot s-empty">2</div>
        <div class="chain-slot s-empty">3</div>
        <div class="chain-slot s-empty">4</div>
        <div class="chain-slot s-empty">5</div>
        <span class="chain-annotation">Slot 0 is both <span class="highlight gold">finalized</span> and <span class="highlight green">justified</span></span>
      </div>

      <!-- Step 2 -->
      <div class="chain-epoch-label">Step 2: Slot 1 justified (&delta;=1, &le;5)</div>
      <div class="chain-row">
        <div class="chain-slot s-finalized tooltip" data-tip="Finalized">0</div>
        <div class="chain-arrow">&rarr;</div>
        <div class="chain-slot s-justified tooltip" data-tip="2/3 votes, delta=1">1</div>
        <div class="chain-slot s-empty">2</div>
        <div class="chain-slot s-empty">&hellip;</div>
        <span class="chain-annotation">2/3 attested source:0 &rarr; target:1. No justifiable gaps &rarr; <span class="highlight gold">slot 0 finalized!</span></span>
      </div>

      <!-- Step 3 -->
      <div class="chain-epoch-label">Step 3: Votes scattered across slots 2-15, no slot reaches 2/3</div>
      <div class="chain-row">
        <div class="chain-slot s-finalized tooltip" data-tip="Now finalized boundary">1</div>
        <div class="chain-slot s-unjustified">2</div>
        <div class="chain-slot s-unjustified">3</div>
        <div class="chain-slot s-unjustified">&hellip;</div>
        <div class="chain-slot s-unjustified">15</div>
        <span class="chain-annotation">Votes too spread out &mdash; no justification</span>
      </div>

      <!-- Step 4 -->
      <div class="chain-epoch-label">Step 4: Slot 16 justified (&delta;=16 from finalized=0 &rarr; 16=4&sup2;)</div>
      <div class="chain-row">
        <div class="chain-slot s-finalized">1</div>
        <div class="chain-slot s-unjustified">&hellip;</div>
        <div class="chain-arrow">&rarr;</div>
        <div class="chain-slot s-justified tooltip" data-tip="delta=16, perfect square 4&sup2;">16</div>
        <span class="chain-annotation">Justifiable gaps exist between 1 and 16 (slots 2,3,4,5,6,9,12) &rarr; <span class="highlight red">slot 1 NOT finalized</span></span>
      </div>

      <!-- Step 5 -->
      <div class="chain-epoch-label">Step 5: Slot 20 justified (&delta;=20, pronic: 4&times;5) with source=16</div>
      <div class="chain-row">
        <div class="chain-slot s-finalized tooltip" data-tip="Source for slot 20 attestation">16</div>
        <div class="chain-slot s-unjustified">17</div>
        <div class="chain-slot s-unjustified">18</div>
        <div class="chain-slot s-unjustified">19</div>
        <div class="chain-arrow">&rarr;</div>
        <div class="chain-slot s-justified tooltip" data-tip="delta=20, pronic 4&times;5">20</div>
        <span class="chain-annotation">No justifiable slots between 16 and 20 &rarr; <span class="highlight gold">slot 16 finalized!</span></span>
      </div>
    </div>

    <div class="card" style="margin-top:1rem;background:var(--bg);border-color:var(--emerald);border-width:1px">
      <div style="display:flex;align-items:flex-start;gap:1rem">
        <div style="font-size:1.5rem;flex-shrink:0">&#x1F4A1;</div>
        <div>
          <p style="font-size:0.85rem;color:var(--text);margin-bottom:0.35rem"><strong>Why unjustifiable slots matter:</strong></p>
          <p style="font-size:0.8rem;color:var(--text-dim)">Under network stress, validator votes scatter across many slots. By making most slots <em>unjustifiable</em>, 3SF-mini forces votes to concentrate on fewer eligible targets. The backoff pattern (close &rarr; squares &rarr; pronic) ensures rapid finalization in good conditions, while the widening gaps in bad conditions still eventually funnel enough votes to reach 2/3 supermajority.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════ FOOTER ═══════ -->
  <div class="footer">
    <p>ethlambda &mdash; A minimalist Lean Ethereum consensus client</p>
    <p style="margin-top:0.25rem"><a href="https://github.com/lambdaclass/ethlambda">github.com/lambdaclass/ethlambda</a></p>
  </div>

</div>

<script>
// Generate justifiability grid (delta 0-50)
function isJustifiable(delta) {
  if (delta <= 5) return { justifiable: true, rule: 'proximity' };
  const sqrtD = Math.floor(Math.sqrt(delta));
  if (sqrtD * sqrtD === delta) return { justifiable: true, rule: 'n\u00B2 (' + sqrtD + '\u00B2)' };
  const check = 4 * delta + 1;
  const sqrtC = Math.floor(Math.sqrt(check));
  if (sqrtC * sqrtC === check && sqrtC % 2 === 1) {
    const n = (sqrtC - 1) / 2;
    return { justifiable: true, rule: 'n(n+1) (' + n + '\u00D7' + (n+1) + ')' };
  }
  return { justifiable: false, rule: 'unjustifiable' };
}

const grid = document.getElementById('justGrid');
for (let delta = 0; delta <= 50; delta++) {
  const cell = document.createElement('div');
  const info = isJustifiable(delta);
  cell.className = 'slot-cell tooltip ' + (delta === 0 ? 'finalized' : info.justifiable ? 'justifiable' : 'unjustifiable');
  cell.textContent = delta;
  cell.setAttribute('data-tip', '\u03B4=' + delta + ': ' + info.rule);
  grid.appendChild(cell);
}
</script>

</body>
</html>
